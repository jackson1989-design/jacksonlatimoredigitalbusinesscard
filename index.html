<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jackson Latimore • Digital Business Card</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React + ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel (for text/babel) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      .custom-scrollbar::-webkit-scrollbar { width: 8px; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.12); border-radius: 999px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }

      @keyframes fadeUp {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-in { animation: fadeUp 220ms ease-out; }

      @keyframes pulseSoft {
        0%, 100% { opacity: 0.6; }
        50% { opacity: 1; }
      }
      .pulse-soft { animation: pulseSoft 1.2s ease-in-out infinite; }
    </style>
  </head>

  <body class="bg-slate-100">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef, useCallback, useMemo } = React;

      // --- DATA & CONFIG ---
      const APP_DATA = {
        name: "Jackson M. Latimore Sr.",
        title: "Founder & CEO",
        company: "Latimore Life & Legacy LLC",
        license: "PA License #1268820",
        tagline: "Protecting Today. Securing Tomorrow.",
        phone: "(856) 895-1457",
        email: "jackson1989@latimorelegacy.com",
        bio:
          "Licensed life, health, accident, and annuities professional providing education-first planning to help families protect what matters and make informed decisions.",
        bannerUrl: "https://jackson1989-design.github.io/latimore-life-legacy-site/hero.jpg",
        links: {
          main: "https://jackson1989-design.github.io/latimore-life-legacy-site/",
          ethos: "https://agents.ethoslife.com/invite/29ad1",
          booking: "https://globalfinancialimpact.fillout.com/t/tMz7ZcqpaZus",
          linkedin: "https://www.linkedin.com/in/startwithjacksongfi/",
          facebook: "https://www.facebook.com/LatimoreLegacyLLC",
          instagram: "https://www.instagram.com/jacksonlatimore.global"
        },
        services: [
          { title: "Wealth Accumulation", icon: "WA", description: "Education on tax-advantaged accumulation concepts and long-term planning considerations." },
          { title: "Asset Protection", icon: "AP", description: "Strategies designed to limit downside exposure and support disciplined planning." },
          { title: "Education Funding", icon: "EF", description: "Funding approaches focused on flexibility, control, and tax efficiency concepts." },
          { title: "Debt Management", icon: "DM", description: "Cash-flow-based payoff sequencing to reduce interest drag and improve liquidity (results depend on income, rates, and consistency)." },
          { title: "Life Insurance", icon: "LI", description: "Coverage designed to create liquidity for beneficiaries and protect income." },
          { title: "Living Benefits", icon: "LB", description: "General education on riders that may allow early access to benefits under qualifying events (terms vary by policy)." },
          { title: "Estate Planning Support", icon: "EP", description: "Coordination support (attorney-led for legal documents) and legacy planning concepts." },
          { title: "Indexed Strategies", icon: "IS", description: "Index-linked product education; features vary by carrier and policy, including caps/spreads/participation." },
          { title: "Mortgage Protection", icon: "MP", description: "Coverage structured to help protect the home and household stability if a covered event occurs." },
          { title: "Business Strategies", icon: "BS", description: "Key person coverage and executive benefit concepts for continuity and retention planning." }
        ]
      };

      // --- LOCAL CONTEXT (Tri-County grounding) ---
      const TRI_COUNTY_CONTEXT = `
LOCAL CONTEXT (Schuylkill • Luzerne • Northumberland):
- High homeownership → mortgage and income protection are practical priorities.
- Aging population → retirement income, legacy planning, and final expense questions are common.
- Blue-collar/logistics + small businesses → workplace coverage gaps and key person risk show up often.
- Tight monthly cashflow → keep recommendations simple and budget-aware.
Tone: preparation, protection, legacy — never fear-based.
`;

      // --- ANALYTICS (privacy-first) ---
      // Stores anonymous category counts in localStorage. No names/emails stored in analytics.
      const ANALYTICS_KEY = "latimore_analytics_v1";
      const getAnalytics = () => {
        try { return JSON.parse(localStorage.getItem(ANALYTICS_KEY) || "{}"); }
        catch { return {}; }
      };
      const bumpAnalytics = (category) => {
        const a = getAnalytics();
        a[category] = (a[category] || 0) + 1;
        localStorage.setItem(ANALYTICS_KEY, JSON.stringify(a));
      };
      const classifyQuestion = (text) => {
        const t = (text || "").toLowerCase();
        const rules = [
          ["mortgage", ["mortgage","home","house"]],
          ["workplace", ["work","employer","job","group","portable"]],
          ["term", ["term","coverage amount","how much","need"]],
          ["living_benefits", ["living benefits","critical","chronic","terminal","rider"]],
          ["iul", ["iul","indexed universal","cash value","cap","floor","participation","spread"]],
          ["annuity", ["annuity","fia","fixed indexed","income rider","lifetime income"]],
          ["debt", ["debt","credit","loan","payoff","interest"]],
          ["business", ["key person","buy-sell","succession","business"]],
          ["final_expense", ["final expense","funeral","burial"]],
          ["pricing", ["price","cost","premium","quote","rates"]],
          ["booking_intent", ["book","schedule","appointment","meeting","call"]],
          ["other", []]
        ];
        for (const [cat, kws] of rules) {
          if (kws.some(k => t.includes(k))) return cat;
        }
        return "other";
      };

      // --- SPANISH QUICK SUMMARY (light) ---
      const wantsSpanish = (text) => /\b(español|espanol|spanish|hola)\b/i.test(text || "");
      const spanishSummary = () => (
`Resumen breve (Español):
Puedo explicar opciones de protección y retiro en palabras sencillas. Si quiere, puedo ayudarle a estimar una cantidad aproximada aquí mismo y explicarle los próximos pasos sin presión.`
      );

      // --- CONVERSATION MEMORY (session-only) ---
      const blankMemory = () => ({ protect: "", priority: "", ageRange: "" });
      const updateMemory = (mem, text) => {
        const t = (text || "").toLowerCase();

        if (!mem.protect) {
          if (t.includes("family") || t.includes("kids") || t.includes("children")) mem.protect = "family";
          else if (t.includes("mortgage") || t.includes("home") || t.includes("house")) mem.protect = "home";
          else if (t.includes("income")) mem.protect = "income";
          else if (t.includes("retire") || t.includes("retirement")) mem.protect = "retirement";
          else if (t.includes("business") || t.includes("key person")) mem.protect = "business";
        }

        if (!mem.priority) {
          if (t.includes("cheap") || t.includes("affordable") || t.includes("lowest cost") || t.includes("budget")) mem.priority = "lowest cost";
          else if (t.includes("strong") || t.includes("most protection") || t.includes("maximize")) mem.priority = "strong protection";
          else if (t.includes("flex") || t.includes("flexible")) mem.priority = "flexibility";
        }

        if (!mem.ageRange) {
          const m = t.match(/\b(18-24|25-34|35-44|45-54|55-64|65\+)\b/);
          if (m) mem.ageRange = m[1];
          const m2 = t.match(/\b(i'?m|im|i am)\s(\d{2})\b/);
          if (m2 && m2[2]) {
            const age = parseInt(m2[2], 10);
            if (!isNaN(age)) {
              if (age < 25) mem.ageRange = "18-24";
              else if (age < 35) mem.ageRange = "25-34";
              else if (age < 45) mem.ageRange = "35-44";
              else if (age < 55) mem.ageRange = "45-54";
              else if (age < 65) mem.ageRange = "55-64";
              else mem.ageRange = "65+";
            }
          }
        }

        return mem;
      };

      // --- EXPANDED KNOWLEDGE BASE (answer-first; booking only when appropriate) ---
      // Each entry can include: headline, keyPoints, disclosure, nextStep (in-chat), bookingWhen (array of triggers)
      const KNOWLEDGE_BASE = [
        {
          id: "workplace_gap",
          keywords: ["work", "employer", "job", "group life", "workplace coverage", "portable"],
          answer: {
            headline: "Workplace life insurance: helpful start, but often not the full plan",
            keyPoints: [
              "Many employer plans are limited (often 1–2x salary) and may not follow you if you change jobs.",
              "It can be smart to keep workplace coverage and add an individual policy to fill the gap and stay portable.",
              "Your plan should match real obligations: mortgage/rent, childcare, debt, and income replacement."
            ],
            disclosure: "Educational info only. Coverage features vary by policy and carrier.",
            nextStep: "Next step: about how much coverage do you have at work (1x salary, 2x salary, or unknown), and do you have a mortgage?"
          }
        },
        {
          id: "coverage_amount",
          keywords: ["how much", "coverage", "need", "amount", "life insurance amount"],
          answer: {
            headline: "How much life insurance is “enough”? A practical tri-county framework",
            keyPoints: [
              "Start with what you’re protecting: (1) income for 10–20 years, (2) mortgage/rent payoff, (3) childcare/education, (4) debts, (5) final costs.",
              "If budget is tight, prioritize the biggest stability risk first (usually income + housing).",
              "We can build a rough range right here without running an application."
            ],
            disclosure: "Educational info only. Not individualized financial advice.",
            nextStep: "Next step: tell me (A) your household income, (B) years left on mortgage/rent plan, and (C) number of dependents."
          }
        },
        {
          id: "term_vs_perm",
          keywords: ["term", "permanent", "whole life", "universal life", "term vs", "difference", "which is better"],
          answer: {
            headline: "Term vs Permanent life insurance — how to choose without overcomplicating it",
            keyPoints: [
              "Term = coverage for a set period (often best for the ‘big responsibility years’ like mortgage/kids).",
              "Permanent = longer-term coverage; some types can build cash value, but costs/charges matter.",
              "A common approach: start with term to protect the basics, then add permanent only if it fits goals and budget."
            ],
            disclosure: "Educational info only. Product terms and costs vary by carrier and underwriting class.",
            nextStep: "Next step: are you mainly protecting your income/mortgage for the next 20–30 years, or planning for lifetime legacy?"
          }
        },
        {
          id: "mortgage_protection",
          keywords: ["mortgage", "home", "house", "protect the house", "keep the house", "mortgage protection"],
          answer: {
            headline: "Mortgage protection: designed to keep the home stable for the family",
            keyPoints: [
              "Typically structured as term life aligned with the mortgage timeline (10/20/30 years).",
              "Goal: enough benefit to protect housing stability and reduce financial shock.",
              "Beneficiary/ownership should match the household plan (who needs the funds to keep the home)."
            ],
            disclosure: "Educational info only. Features vary by policy/carrier.",
            nextStep: "Next step: about how many years remain on your mortgage (10/20/30) and what’s the approximate balance?"
          }
        },
        {
          id: "living_benefits",
          keywords: ["living benefits", "critical illness", "chronic illness", "terminal", "accelerated", "rider"],
          answer: {
            headline: "Living benefits: a policy feature that may help during a serious health event",
            keyPoints: [
              "Some life policies include riders that may allow early access to benefits under defined qualifying events.",
              "Definitions and payout rules vary by carrier and contract—always review the rider language.",
              "It’s not a replacement for health insurance; it’s a separate feature with specific terms."
            ],
            disclosure: "Educational info only. Rider availability varies by product and underwriting.",
            nextStep: "Next step: are you thinking about living benefits mainly for household stability (bills/income), or business continuity?"
          }
        },
        {
          id: "pricing",
          keywords: ["cost", "price", "quote", "premium", "rates", "how much does it cost", "expensive"],
          answer: {
            headline: "What drives pricing (and how to estimate without pressure)",
            keyPoints: [
              "Pricing depends on age range, health history, tobacco status, state, coverage amount, and product type.",
              "Underwriting class can materially change the premium when underwriting applies.",
              "We can do a rough estimate here, then you can choose whether to run a formal quote."
            ],
            disclosure: "Educational info only. Quotes aren’t binding and depend on eligibility/underwriting.",
            nextStep: "Next step: share your age range (25–34/35–44/45–54/55–64/65+), tobacco yes/no, and the coverage amount you’re considering."
          },
          bookingWhen: ["apply", "application", "start", "enroll", "run a quote", "get a quote"]
        },
        {
          id: "iul_basics",
          keywords: ["iul", "indexed universal life", "cash value", "cap", "floor", "participation", "spread", "index"],
          answer: {
            headline: "IUL (Indexed Universal Life): what it is and what it isn’t",
            keyPoints: [
              "IUL is permanent life insurance that may build cash value using index-linked crediting (not a direct stock investment).",
              "Index crediting may use caps/participation/spreads; policy charges still apply even in flat markets.",
              "Loans/withdrawals can reduce values and change performance; design and funding level matter."
            ],
            disclosure: "Educational info only. Not tax/legal advice. Product terms vary by carrier and policy.",
            nextStep: "Next step: is your interest mostly lifetime protection, cash value concepts, or retirement income planning?"
          }
        },
        {
          id: "fia_basics",
          keywords: ["annuity", "fia", "fixed indexed annuity", "indexed annuity", "income rider", "lifetime income"],
          answer: {
            headline: "Fixed Indexed Annuity (FIA): principal protection + index-linked crediting (contract details matter)",
            keyPoints: [
              "An FIA credits interest linked to an index with limits; it’s not a stock investment.",
              "Most contracts have surrender periods and liquidity rules—typically long-term money.",
              "Income features (when elected) are contract-based and depend on terms and rider costs."
            ],
            disclosure: "Educational info only. Features, surrender periods, and rider costs vary by product.",
            nextStep: "Next step: are you looking for accumulation, or specifically for predictable lifetime income?"
          }
        },
        {
          id: "debt_strategy",
          keywords: ["debt", "credit card", "loan", "payoff", "interest", "student loan"],
          answer: {
            headline: "Debt strategy: reduce interest drag while protecting cashflow",
            keyPoints: [
              "The goal is to lower interest waste without draining emergency reserves.",
              "Payoff sequencing often prioritizes highest-rate debt while keeping minimums elsewhere.",
              "Small changes (payment timing, budgeting, refinance evaluation) can improve control."
            ],
            disclosure: "Educational info only. Not legal, tax, or credit counseling advice.",
            nextStep: "Next step: which is biggest right now—credit cards, auto, student loans, or mortgage?"
          }
        },
        {
          id: "final_expense",
          keywords: ["final expense", "funeral", "burial", "cremation", "end of life"],
          answer: {
            headline: "Final expense coverage: planning for dignity and fewer financial surprises",
            keyPoints: [
              "Typically smaller permanent coverage meant to help with funeral and final costs.",
              "Helps loved ones avoid scrambling or taking on high-interest debt.",
              "The right amount depends on your preferences and existing savings."
            ],
            disclosure: "Educational info only. Availability varies by health and product.",
            nextStep: "Next step: are you aiming to cover funeral only, or also leave a small cushion for family expenses?"
          }
        },
        {
          id: "business_key_person",
          keywords: ["key person", "buy-sell", "succession", "business", "partner", "executive benefits"],
          answer: {
            headline: "Business protection: key person + continuity planning in plain language",
            keyPoints: [
              "Key person coverage can help a business keep operating if a key leader is lost.",
              "Buy-sell planning sets a clear ownership transition path and funding can create real liquidity.",
              "The right design depends on revenue dependence, partners, and time horizon."
            ],
            disclosure: "Educational info only. Not legal advice; attorney drafts legal agreements.",
            nextStep: "Next step: is this a solo owner, or do you have partners who would need a clear transition plan?"
          }
        },
        {
          id: "rule_72",
          keywords: ["rule of 72", "72", "doubling", "double", "compound", "compound interest"],
          answer: {
            headline: "Rule of 72: estimating how quickly money can double",
            keyPoints: [
              "Divide 72 by an annual rate to estimate the doubling timeframe.",
              "Example: 6% ≈ 12 years (72 ÷ 6), 9% ≈ 8 years (72 ÷ 9).",
              "It’s a shortcut for comparisons—not a guarantee.",
              "Inflation matters; purchasing power can still fall if inflation is higher than growth."
            ],
            disclosure: "Educational info only. Actual outcomes depend on product terms, costs, and market conditions.",
            nextStep: "Next step: are you using this for savings growth, retirement planning, or comparing debt interest?"
          }
        }
      ];

      // --- helper: normalize + matching ---
      const normalize = (s) =>
        (s || "")
          .toLowerCase()
          .replace(/[^\w\s]/g, " ")
          .replace(/\s+/g, " ")
          .trim();

      const scoreEntry = (text, entry) => {
        const t = normalize(text);
        let score = 0;

        for (const kw of entry.keywords || []) {
          const k = normalize(kw);
          if (!k) continue;

          if (t.includes(k)) score += Math.min(10, 3 + k.split(" ").length);
          if (k.split(" ").length === 1 && t.split(" ").includes(k)) score += 2;
        }

        if (/[?]/.test(text)) score += 1;
        if (/\b(compare|difference|pros|cons|best|should|recommend)\b/i.test(text)) score += 1;
        if (/\b(mortgage|work|quote|premium|annuity|iul|living)\b/i.test(text)) score += 1;

        return score;
      };

      const formatAnswer = (entry, memory) => {
        const a = entry.answer || {};
        const bullets = (a.keyPoints || []).map((p) => `• ${p}`).join("\n");
        const disclosure = a.disclosure ? `\n\n${a.disclosure}` : "";
        const next = a.nextStep ? `\n\n${a.nextStep}` : "";

        // Gentle local grounding (short; not spammy)
        const local = `\n\n(Quick local note: ${TRI_COUNTY_CONTEXT.split("\n").filter(Boolean)[1] || ""})`;

        // Memory-aware personalization (small)
        const memLineParts = [];
        if (memory?.protect) memLineParts.push(`protecting: ${memory.protect}`);
        if (memory?.priority) memLineParts.push(`priority: ${memory.priority}`);
        if (memory?.ageRange) memLineParts.push(`age range: ${memory.ageRange}`);
        const memLine = memLineParts.length ? `\n\nWhat I’m tracking so far: ${memLineParts.join(" • ")}.` : "";

        return `${a.headline || "Information"}\n\n${bullets}${disclosure}${memLine}${local}${next}`;
      };

      // Booking should be OPTIONAL and only when user is asking for personalization/apply/quote.
      const shouldSuggestBooking = (text) => {
        const t = normalize(text);
        const triggers = [
          "apply","application","enroll","start","sign up",
          "quote","premium","rates","price","how much will it cost",
          "recommend","best for me","compare options","review my policy",
          "underwriting","denied","medical exam"
        ];
        return triggers.some(k => t.includes(k));
      };

      // --- TYPEWRITER ---
      const Typewriter = ({ text, onComplete }) => {
        const [displayedText, setDisplayedText] = useState("");
        useEffect(() => {
          let index = 0;
          const timer = setInterval(() => {
            setDisplayedText((prev) => prev + text.charAt(index));
            index++;
            if (index === text.length) {
              clearInterval(timer);
              if (onComplete) onComplete();
            }
          }, 10);
          return () => clearInterval(timer);
        }, [text]);
        return <span className="whitespace-pre-wrap">{displayedText}</span>;
      };

      // --- SOCIAL BUTTON ---
      const SocialBtn = ({ href, label }) => (
        <a
          href={href}
          target="_blank"
          rel="noopener noreferrer"
          className="flex items-center justify-center h-12 px-4 bg-white border-2 border-slate-100 rounded-2xl text-[#1D3A5F] hover:border-[#C29D6F] hover:bg-[#C29D6F]/5 transition-all text-xs font-bold uppercase tracking-wider"
          aria-label={label}
        >
          {label}
        </a>
      );

      // --- SAVE PLAN (soft lead capture) ---
      // Stores the saved plan locally; can optionally open email compose.
      const SAVED_PLANS_KEY = "latimore_saved_plans_v1";
      const getSavedPlans = () => {
        try { return JSON.parse(localStorage.getItem(SAVED_PLANS_KEY) || "[]"); }
        catch { return []; }
      };
      const savePlanLocal = (plan) => {
        const existing = getSavedPlans();
        existing.unshift({ ...plan, savedAt: new Date().toISOString() });
        localStorage.setItem(SAVED_PLANS_KEY, JSON.stringify(existing.slice(0, 25)));
      };

      // --- COMPONENT: ASSISTANT ---
      const Assistant = ({ onClose, initialQuery }) => {
        const [messages, setMessages] = useState([
          {
            role: "assistant",
            content:
              "Hey — I’m the Latimore Life & Legacy assistant. I can explain coverage options in plain language (life insurance, living benefits, mortgage protection, retirement income, and business continuity).\n\nWhat are you trying to protect right now: your family, your home, your income, your retirement, or your business?"
          }
        ]);
        const [input, setInput] = useState("");
        const [isTyping, setIsTyping] = useState(false);
        const [memory, setMemory] = useState(blankMemory());
        const [showSave, setShowSave] = useState(false);
        const [savedToast, setSavedToast] = useState(false);
        const [saveEmail, setSaveEmail] = useState("");
        const scrollRef = useRef(null);
        const hasAutoQueried = useRef(false);

        useEffect(() => {
          if (scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
        }, [messages, isTyping]);

        const generateResponse = (userText) => {
          // analytics
          bumpAnalytics(classifyQuestion(userText));

          // pick best KB entry
          const ranked = KNOWLEDGE_BASE
            .map((entry) => ({ entry, score: scoreEntry(userText, entry) }))
            .sort((a, b) => b.score - a.score);

          const best = ranked[0];
          const matched = best && best.score >= 3 ? best.entry : null;

          if (!matched) {
            return (
              "I can help—pick the closest option and I’ll outline the key considerations:\n\n" +
              "• Family protection (life insurance basics)\n" +
              "• Mortgage protection\n" +
              "• Living benefits (serious illness riders)\n" +
              "• Retirement income concepts (annuities)\n" +
              "• IUL basics (cash value life insurance)\n" +
              "• Business planning (key person / buy-sell)\n\n" +
              "Reply with one, and tell me what matters most: lowest cost, strongest protection, or flexibility."
            );
          }

          let response = formatAnswer(matched, memory);

          // Spanish quick summary only when asked
          if (wantsSpanish(userText)) {
            response += "\n\n" + spanishSummary();
          }

          // Booking suggestion ONLY when appropriate
          if (shouldSuggestBooking(userText)) {
            response += `\n\nIf you want a personalized plan (amount, options, and next steps), you can schedule a no-pressure review here:\n${APP_DATA.links.booking}`;
          } else {
            response += "\n\nNext best step (in chat): share your age range and what matters most (lowest cost, strongest protection, or flexibility).";
          }

          // Soft lead capture prompt
          response += "\n\nIf you’d like, I can save a quick summary of this plan for you.";

          return response;
        };

        const handleSend = useCallback(
          (overrideText) => {
            const text = (overrideText ?? input).trim();
            if (!text || isTyping) return;

            setInput("");
            setMessages((prev) => [...prev, { role: "user", content: text }]);

            // update memory
            setMemory((prev) => updateMemory({ ...prev }, text));

            setIsTyping(true);
            setShowSave(false);

            setTimeout(() => {
              const responseText = generateResponse(text);
              setMessages((prev) => [...prev, { role: "assistant", content: responseText, type: "typewriter" }]);
              setIsTyping(false);
              setShowSave(true); // show opt-in save after assistant answers
            }, 550);
          },
          [input, isTyping, memory]
        );

        useEffect(() => {
          if (initialQuery && !hasAutoQueried.current) {
            hasAutoQueried.current = true;
            handleSend(initialQuery);
          }
        }, [initialQuery, handleSend]);

        // ESC to close
        useEffect(() => {
          const onKey = (e) => {
            if (e.key === "Escape") onClose();
          };
          window.addEventListener("keydown", onKey);
          return () => window.removeEventListener("keydown", onKey);
        }, [onClose]);

        const saveCurrentPlan = () => {
          const lastAssistant = [...messages].reverse().find(m => m.role === "assistant");
          if (!lastAssistant) return;

          const plan = {
            memory,
            summary: lastAssistant.content,
            source: "assistant",
          };
          savePlanLocal(plan);

          // optional email (opens user's mail client; no server)
          if (saveEmail.trim()) {
            const subject = encodeURIComponent("Saved Plan Summary • Latimore Life & Legacy");
            const body = encodeURIComponent(
              `Here’s your saved summary:\n\n${lastAssistant.content}\n\n— ${APP_DATA.company}\n${APP_DATA.tagline}\n${APP_DATA.links.main}`
            );
            window.location.href = `mailto:${saveEmail.trim()}?subject=${subject}&body=${body}`;
          }

          setSavedToast(true);
          setTimeout(() => setSavedToast(false), 1800);
          setShowSave(false);
          setSaveEmail("");
        };

        const viewAnalytics = () => {
          const a = getAnalytics();
          const lines = Object.entries(a)
            .sort(([,v1],[,v2]) => (v2||0)-(v1||0))
            .map(([k,v]) => `${k}: ${v}`)
            .join("\n");
          alert(lines ? `Anonymous question categories (this device):\n\n${lines}` : "No analytics recorded yet on this device.");
        };

        return (
          <div className="flex flex-col h-full bg-slate-50">
            <div className="p-5 bg-[#1D3A5F] text-white flex justify-between items-center shrink-0">
              <div className="flex items-center space-x-3">
                <div className="bg-[#C29D6F] px-3 py-2 rounded-lg text-xs font-black tracking-widest">AI</div>
                <div>
                  <h3 className="font-bold text-base">Legacy Advisor</h3>
                  <p className="text-[10px] text-[#C29D6F] font-bold uppercase tracking-widest">Education-First Assistant</p>
                </div>
              </div>
              <div className="flex items-center gap-2">
                <button
                  onClick={viewAnalytics}
                  className="text-[10px] px-3 py-2 rounded-full bg-white/10 hover:bg-white/15"
                  title="View anonymous analytics (this device)"
                >
                  Analytics
                </button>
                <button
                  onClick={onClose}
                  className="w-8 h-8 flex items-center justify-center hover:bg-white/10 rounded-full transition-colors text-xl"
                  aria-label="Close assistant"
                >
                  ×
                </button>
              </div>
            </div>

            <div ref={scrollRef} className="flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar">
              {messages.map((msg, idx) => (
                <div key={idx} className={`flex ${msg.role === "user" ? "justify-end" : "justify-start"} animate-in`}>
                  <div
                    className={`max-w-[88%] p-3.5 rounded-2xl shadow-sm text-sm ${
                      msg.role === "user"
                        ? "bg-[#1D3A5F] text-white rounded-tr-none"
                        : "bg-white border border-slate-200 text-slate-700 rounded-tl-none"
                    }`}
                  >
                    {msg.type === "typewriter" && idx === messages.length - 1 ? (
                      <Typewriter text={msg.content} />
                    ) : (
                      <span className="whitespace-pre-wrap">{msg.content}</span>
                    )}
                  </div>
                </div>
              ))}

              {isTyping && (
                <div className="flex justify-start animate-in">
                  <div className="bg-white border border-slate-200 p-3 rounded-2xl flex items-center space-x-2 shadow-sm">
                    <span className="w-2 h-2 bg-[#C29D6F] rounded-full pulse-soft"></span>
                    <span className="w-2 h-2 bg-[#C29D6F] rounded-full pulse-soft" style={{ animationDelay: "0.15s" }}></span>
                    <span className="w-2 h-2 bg-[#C29D6F] rounded-full pulse-soft" style={{ animationDelay: "0.3s" }}></span>
                  </div>
                </div>
              )}
            </div>

            {/* Soft lead capture (Save plan) */}
            {showSave && !isTyping && (
              <div className="px-4 pb-2 bg-white border-t">
                <div className="mt-3 p-3 rounded-2xl bg-slate-50 border border-slate-100">
                  <div className="text-xs font-bold text-[#1D3A5F]">Save this plan summary?</div>
                  <div className="text-[11px] text-slate-500 mt-1">
                    Optional: add your email to send a copy. (No pressure — you can skip this.)
                  </div>
                  <div className="flex gap-2 mt-2">
                    <input
                      value={saveEmail}
                      onChange={(e) => setSaveEmail(e.target.value)}
                      placeholder="Optional email (for your copy)"
                      className="flex-1 bg-white border border-slate-200 rounded-xl px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-[#C29D6F]/40"
                    />
                    <button
                      onClick={saveCurrentPlan}
                      className="px-4 py-2 rounded-xl bg-[#C29D6F] text-white text-xs font-bold hover:opacity-90"
                    >
                      Save
                    </button>
                  </div>
                </div>
              </div>
            )}

            <div className="p-4 border-t bg-white shrink-0">
              <div className="flex space-x-2">
                <input
                  type="text"
                  value={input}
                  onChange={(e) => setInput(e.target.value)}
                  onKeyDown={(e) => e.key === "Enter" && handleSend()}
                  placeholder="Ask a planning question..."
                  className="flex-1 bg-slate-100 px-4 py-3 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#C29D6F]/50"
                />
                <button
                  onClick={() => handleSend()}
                  disabled={isTyping || !input.trim()}
                  className="w-12 bg-[#1D3A5F] text-white rounded-xl shadow-md hover:bg-[#152a45] active:scale-95 transition-all flex items-center justify-center disabled:opacity-50"
                  aria-label="Send message"
                >
                  →
                </button>
              </div>

              {savedToast && (
                <div className="mt-2 text-[11px] text-emerald-700 font-semibold">
                  Saved locally ✅
                </div>
              )}

              <p className="text-[10px] text-slate-400 mt-3 leading-relaxed">
                Educational information only. No individualized financial, tax, or legal advice is provided here. Policy features vary by carrier and product.
              </p>
            </div>
          </div>
        );
      };

      // --- MAIN APP ---
      const App = () => {
        const [showAssistant, setShowAssistant] = useState(false);
        const [assistantQuery, setAssistantQuery] = useState(null);
        const [selectedService, setSelectedService] = useState(null);
        const [copied, setCopied] = useState(false);

        const handleCopyLink = () => {
          navigator.clipboard.writeText(window.location.href);
          setCopied(true);
          setTimeout(() => setCopied(false), 2000);
        };

        const handleSaveContact = () => {
          const vcardRows = [
            "BEGIN:VCARD",
            "VERSION:3.0",
            `FN:${APP_DATA.name}`,
            `ORG:${APP_DATA.company}`,
            `TITLE:${APP_DATA.title}`,
            `TEL;TYPE=WORK,VOICE:${APP_DATA.phone}`,
            `EMAIL;TYPE=WORK,INTERNET:${APP_DATA.email}`,
            `URL:${APP_DATA.links.main}`,
            "END:VCARD"
          ];
          const blob = new Blob([vcardRows.join("\n")], { type: "text/vcard" });
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = "Latimore_Legacy.vcf";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        };

        useEffect(() => {
          const anyModalOpen = showAssistant || !!selectedService;
          document.body.style.overflow = anyModalOpen ? "hidden" : "";
          return () => { document.body.style.overflow = ""; };
        }, [showAssistant, selectedService]);

        const openAssistantWith = (query) => {
          setAssistantQuery(query || null);
          setShowAssistant(true);
        };

        return (
          <div className="min-h-screen flex flex-col items-center sm:py-10 selection:bg-[#C29D6F]/30">
            <div className="w-full max-w-[440px] bg-white sm:rounded-[3rem] shadow-2xl overflow-hidden relative sm:border border-slate-200 min-h-screen sm:min-h-[800px]">

              {/* Banner */}
              <div className="w-full h-80 relative flex items-center justify-center overflow-hidden bg-[#1D3A5F]">
                <img src={APP_DATA.bannerUrl} alt="Banner" className="w-full h-full object-cover opacity-90" />
                <div className="absolute inset-0 bg-gradient-to-t from-[#1D3A5F]/90 to-transparent" />
                <div className="absolute bottom-0 w-full h-1.5 bg-[#C29D6F]" />
              </div>

              {/* Profile */}
              <div className="text-center px-6 -mt-20 relative z-10 pb-8">
                <div className="w-32 h-32 mx-auto rounded-full bg-white p-1 shadow-xl mb-4">
                  <div className="w-full h-full rounded-full bg-[#1D3A5F] flex items-center justify-center text-3xl overflow-hidden text-white font-black tracking-wider">
                    JL
                  </div>
                </div>

                <h1 className="text-2xl font-black text-[#1D3A5F] tracking-tight">{APP_DATA.name}</h1>
                <p className="text-[#C29D6F] font-bold text-xs uppercase tracking-widest mt-1">{APP_DATA.title}</p>
                <p className="text-slate-500 text-xs mt-1">{APP_DATA.company}</p>
                <p className="text-slate-400 text-[11px] mt-2">{APP_DATA.license}</p>

                <div className="flex justify-center gap-3 mt-6 flex-wrap">
                  <SocialBtn href={APP_DATA.links.linkedin} label="LinkedIn" />
                  <SocialBtn href={APP_DATA.links.facebook} label="Facebook" />
                  <SocialBtn href={APP_DATA.links.instagram} label="Instagram" />
                  <SocialBtn href={APP_DATA.links.main} label="Website" />
                </div>

                <div className="mt-8 mx-2 px-6 py-6 bg-slate-50 rounded-3xl border border-slate-100 relative">
                  <span className="absolute -top-3 left-4 text-[#C29D6F] text-5xl font-serif">"</span>
                  <p className="text-[#1D3A5F] text-sm leading-relaxed italic font-medium relative z-10">
                    {APP_DATA.bio}
                  </p>
                  <p className="text-slate-500 text-xs mt-4 font-semibold">{APP_DATA.tagline}</p>
                </div>
              </div>

              {/* Actions */}
              <div className="px-6 space-y-3 mb-10">
                <a
                  href={`mailto:${APP_DATA.email}`}
                  className="flex items-center justify-center w-full py-4 bg-[#1D3A5F] text-white rounded-2xl shadow-lg hover:bg-[#152a45] transition-all font-bold text-sm"
                >
                  Email
                </a>

                <a
                  href={APP_DATA.links.booking}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center justify-center w-full py-4 bg-[#C29D6F] text-white rounded-2xl shadow-lg hover:opacity-90 transition-all font-bold text-sm"
                >
                  Schedule Review
                </a>

                <div className="grid grid-cols-2 gap-3 pt-1">
                  <button
                    onClick={handleCopyLink}
                    className="flex items-center justify-center py-3 border border-slate-200 rounded-xl text-slate-600 font-semibold text-xs hover:bg-slate-50"
                  >
                    {copied ? "Copied" : "Copy Link"}
                  </button>
                  <button
                    onClick={handleSaveContact}
                    className="flex items-center justify-center py-3 bg-slate-800 text-white rounded-xl shadow-md font-semibold text-xs hover:bg-slate-900"
                  >
                    Save Contact
                  </button>
                </div>

                <p className="text-[10px] text-slate-400 leading-relaxed pt-2">
                  Educational information and planning support. Not legal or tax advice. Product availability, terms, and features vary by carrier and policy.
                </p>
              </div>

              {/* Services */}
              <div className="px-4 mb-24">
                <div className="bg-slate-50 rounded-[2.5rem] p-6 border border-slate-100 shadow-inner">
                  <h2 className="text-[#1D3A5F] text-center font-black text-[10px] uppercase tracking-[0.25em] mb-8 pb-4 border-b border-[#C29D6F]/20">
                    Services
                  </h2>

                  <div className="grid grid-cols-2 gap-4">
                    {APP_DATA.services.map((service, i) => (
                      <button
                        key={i}
                        onClick={() => setSelectedService(service)}
                        className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center text-center hover:border-[#C29D6F] transition-all h-32 justify-center"
                      >
                        <div className="w-11 h-11 rounded-2xl bg-slate-100 flex items-center justify-center text-[#1D3A5F] font-black text-sm mb-2">
                          {service.icon}
                        </div>
                        <span className="text-[10px] font-bold text-[#1D3A5F] uppercase leading-tight">
                          {service.title}
                        </span>
                      </button>
                    ))}
                  </div>
                </div>
              </div>

              {/* Floating Chat */}
              <button
                onClick={() => openAssistantWith(null)}
                className="absolute bottom-6 right-6 bg-[#1D3A5F] px-5 py-4 rounded-full text-white shadow-2xl hover:scale-105 transition-all z-20 border-2 border-[#C29D6F]"
                aria-label="Open assistant"
              >
                <span className="text-xs font-black tracking-widest">ASSIST</span>
              </button>

              {/* Service Modal */}
              {selectedService && (
                <div
                  className="absolute inset-0 z-40 flex items-center justify-center p-4 bg-[#1D3A5F]/60 backdrop-blur-sm"
                  onClick={() => setSelectedService(null)}
                >
                  <div
                    className="bg-white w-full max-w-sm rounded-[2rem] p-8 relative animate-in"
                    onClick={(e) => e.stopPropagation()}
                  >
                    <button
                      onClick={() => setSelectedService(null)}
                      className="absolute top-6 right-6 p-2 bg-slate-100 rounded-full text-slate-600"
                      aria-label="Close service"
                    >
                      ×
                    </button>

                    <div className="w-12 h-12 rounded-2xl bg-slate-100 flex items-center justify-center text-[#1D3A5F] font-black text-sm mb-4">
                      {selectedService.icon}
                    </div>

                    <h3 className="text-[#1D3A5F] font-black text-xl mb-2">{selectedService.title}</h3>
                    <p className="text-slate-600 text-sm leading-relaxed">{selectedService.description}</p>

                    <div className="mt-6 grid grid-cols-2 gap-3">
                      <a
                        href={APP_DATA.links.booking}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="py-3 rounded-xl bg-[#C29D6F] text-white font-bold text-xs text-center hover:opacity-90"
                      >
                        Book Review
                      </a>

                      <button
                        onClick={() => {
                          const q = `Explain ${selectedService.title} in simple terms and what to consider.`;
                          setSelectedService(null);
                          openAssistantWith(q);
                        }}
                        className="py-3 rounded-xl border border-slate-200 text-[#1D3A5F] font-bold text-xs hover:bg-slate-50"
                      >
                        Ask Assistant
                      </button>
                    </div>

                    <p className="text-[10px] text-slate-400 mt-5 leading-relaxed">
                      Educational information only. Not individualized financial, tax, or legal advice. Product features vary by carrier and policy.
                    </p>
                  </div>
                </div>
              )}

              {/* Assistant Modal */}
              {showAssistant && (
                <div
                  className="absolute inset-0 z-50 bg-[#1D3A5F]/60 backdrop-blur-sm p-4 flex items-center justify-center"
                  onClick={() => setShowAssistant(false)}
                >
                  <div
                    className="bg-white w-full max-w-sm h-[600px] rounded-[2rem] overflow-hidden shadow-2xl animate-in"
                    onClick={(e) => e.stopPropagation()}
                  >
                    <Assistant
                      initialQuery={assistantQuery}
                      onClose={() => {
                        setShowAssistant(false);
                        setAssistantQuery(null);
                      }}
                    />
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
